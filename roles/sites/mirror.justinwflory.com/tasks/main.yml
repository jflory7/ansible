---
# CAVEAT: This role requires LetsEncrypt SSL certs to already be in place.
# For future reference: https://certbot-dns-cloudflare.readthedocs.io/en/latest/

- name: create server block root directory
  file:
    state: directory
    path: "/var/www/mirror.justinwflory.com/"
    mode: 0755
    seuser: system_u
    setype: httpd_sys_content_t

- name: nginx - create html directory
  file:
    state: directory
    path: "/var/www/mirror.justinwflory.com/html/"
    mode: 0775
    group: www-admin
    owner: www-admin
    seuser: system_u
    setype: httpd_sys_content_t

- name: nginx - create logs directory
  file:
    state: directory
    path: "/var/www/mirror.justinwflory.com/logs/"
    mode: 0755
    group: nginx
    owner: nginx
    seuser: system_u
    setype: httpd_log_t

- name: copy index.html and favicon.ico
  copy:
    src: "{{ item }}"
    dest: "/var/www/mirror.justinwflory.com/html/{{ item }}"
    mode: 0664
    group: www-admin
    owner: www-admin
    seuser: system_u
    setype: httpd_sys_content_t
  with_items:
    - index.html
    - favicon.ico
    - blank.gif
    - folder.gif

- name: nginx - copy mirror.justinwflory.com.conf
  copy:
    src: mirror.justinwflory.com.conf
    dest: "/etc/nginx/conf.d/mirror.justinwflory.com.conf"
    mode: 0644
  notify: restart nginx

- name: create public directory in mirror.justinwflory.com root directory
  file:
    state: directory
    path: "/var/www/mirror.justinwflory.com/html/pub/"
    mode: 0775
    group: www-admin
    owner: www-admin
    seuser: system_u
    setype: httpd_sys_content_t
