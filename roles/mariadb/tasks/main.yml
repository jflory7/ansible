---
- name: "RedHat 7 - install mariadb-server v10.3 from IUS"
  package:
    state: present
    name: mariadb103-server
  when:
    - ansible_facts['os_family'] == "RedHat"
    - ansible_facts['distribution_major_version'] == "7"

- name: "RedHat 8 - install mariadb-server AppStream"
  dnf:
    state: present
    name: '@mariadb/server'
  when:
    - ansible_facts['os_family'] == "RedHat"
    - ansible_facts['distribution_major_version'] == "8"

- name: push 999-custom.cnf to /etc/my.cnf.d/
  template:
    src: 999-custom.cnf
    dest: /etc/my.cnf.d/999-custom.cnf
    mode: 0644
    owner: root
    group: root
    setype: mysqld_etc_t
    seuser: system_u
  notify: restart mariadb.service

- name: start/enable mariadb.service
  service:
    name: mariadb.service
    state: started
    enabled: yes
